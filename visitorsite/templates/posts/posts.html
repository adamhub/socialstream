{% extends "main.html" %}

    {% block head %} 
        <title>All Posts</title>
    {% endblock head %}

    {% block head-extra %}
    {% endblock head-extra %}

    {% block content %}
        <div class="container-fluid">
            <div class="{% if object_list %}grid{% else %}row {% endif %} " >
                <div class="grid__col_sizer"></div>
                <div class="grid__gutter-sizer"></div>
                {% if object_list %}
                    {% for post in object_list %}
                        <div class="grid__item ss-card bg-white shadow-sm rounded border">
                            <div class="hhcard">
			        <div class="ss-card-header p-3 border-bottom">
				    <span class="ss-author mr-3">{{post.creator}}</span>
				    {% if post.date_published %}
				      <span class="ss-published">{{ post.date_published }}</span>
				    {% endif %}
				</div>
                                {% if post.embed_file %}
                                    {% if post.embed_file.link %}
                                        {% load micawber_tags %}
                                        {{ post.embed_file.link|oembed:"460x600" }}
                                    {% else %}
                                        {{ object.embed_file.embed_code|safe }}
                                    {% endif %}
                                {% elif post.image %}
                                    <img src="{{ post.image.url }}" width="100%" alt="{{ post.image.alt }}" class="header_image" /> 
                                {% else %}
                                    <img src="{{post.external_image}}" width="100%" alt="{{ post.image.alt }}" class="header_image" style="-webkit-user-select: none;margin: auto;background-color: hsl(0, 0%, 90%);transition: background-color 300ms;" > 
                                {% endif %}
				    <div class="card-content p-3">
				      <div class="text-section mb-5">
					<h5 class="blog-list-title">
					  <a href="{{ post.get_absolute_url }}" class="inner">{{ post.title }}</a>
					</h5>
					<p class="lead">{{ post.body|truncatewords:15 }}</p>
				      </div>

				      <div class="ss-comment-section mb-4">
					{% for comment in post.get_obj_latest_comments %}
                                        {% if forloop.counter < 4 %}
				        <div class="comment mb-3">
				          <p class="comment-byline text-uppercase mb-1 small">
				            <span class="username text-primary">{{ comment.user_name }} - </span><span class="comment-datetime text-muted">Feb 3, 2021 - 10:04pm</span>
				          </p>
				          <p class="comment-text">{{ comment.comment }}</p>
				        </div>
                                        {% endif %}
					{% endfor %}
				      </div>
				      <form class="form-inline">
					  <div class="flex-grow-1 mr-2">
					    <label class="sr-only" for="add-reply">Add Reply</label>
					    <input type="text" class="form-control w-100" id="add-reply" placeholder="Add Reply">
					  </div>
					  <button type="submit" class="btn btn-primary">Reply</button>
					</div>
				      </form>

				    </div>                                
                            </div>
                        </div>
                    {% endfor %}
                                        
                {% else %}
                    <div class="col-md-12">
                        <p>Oh, snap. Looks like we were too busy (serving the world) to write any blog posts. Sorry.</p>
                    </div>
                {% endif %}
            </div>
            
        </div>     
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://getbootstrap.com/docs/5.0/dist/js/bootstrap.bundle.min.js"  crossorigin="anonymous"></script>
        <script src="https://unpkg.com/infinite-scroll@4/dist/infinite-scroll.pkgd.js"  crossorigin="anonymous"></script>
        <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.js"  crossorigin="anonymous"></script>
        
    {% endblock %}

    {% block library_css %}


    {% endblock library_css %}

    {% block extra_scripts %}
        let grid = document.querySelector('.grid');

        let msnry = new Masonry( grid, {
            itemSelector: 'none', // select none at first
            columnWidth: '.grid__col_sizer',
            gutter: '.grid__gutter-sizer',
            percentPosition: true,
            is_paginated: false,
            stagger: 30,
            // nicer reveal transition
            visibleStyle: { transform: 'translateY(0)', opacity: 1 },
            hiddenStyle: { transform: 'translateY(100px)', opacity: 0 },
        });

        // initial items reveal
        imagesLoaded( grid, function() {
            grid.classList.remove('are-images-unloaded');
            msnry.options.itemSelector = '.grid__item';
            let items = grid.querySelectorAll('.grid__item');
            msnry.appended( items );
        });

        var nextSlugs = [
            {% if is_paginated %}
            // {{ page_obj}}
            {% for page in paginator %}
                {% if page.has_next %}
                    "?page={{ page.next_page_number }}",
                {% endif %}
            {% endfor %}
            {% endif %}
        ];

        function getPath() {
            let slug = nextSlugs[ this.loadCount ];
            if ( slug ) {
                return `${slug}`;
            }
        }

        //--------------- init Infinte Scroll ----------------------//
        let infScroll = new InfiniteScroll( grid, {
            path: getPath,
            append: '.grid__item',
            outlayer: msnry,
            prefill: false,
            history: false,
            status: '.page-load-status',
        });

    {% endblock extra_scripts %}

